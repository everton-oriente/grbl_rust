
# RP2350B + Embassy: DMA + PIO Stepper (6 axes skeleton; X/Y enabled)

This project is the **six-axis** version of the DMA+PIO stepper engine for **Raspberry Pi Pico 2 / RP2350B** using **Embassy**.

- Generic driver supports **PIO0/PIO1/PIO2**, any **SM index**, and **DMA channel**.
- **X** and **Y** axes are **enabled**; **Z/A/B/C** are present but **commented** (pins & instantiation).
- STEP timing is generated by **PIO** (side-set) → hard real-time; **DMA** is paced by **PIO TX DREQ**.

## Wiring (example for X/Y, TMC2209)
- X: STEP GPIO6 (PIO0.SM0 side-set), DIR GPIO7, EN GPIO8
- Y: STEP GPIO10 (PIO1.SM0 side-set), DIR GPIO11, EN GPIO12

> Edit pins in `main.rs` to match your board. Commented axes show example mappings you can enable later.

## Build & flash
```bash
rustup target add thumbv8m.main-none-eabihf
cargo build --release
probe-rs run --chip RP2350 --release
```

## Files
- `src/hw/stepper_pio_dma_multi.rs`: Generic PIO program + DMA feeder for any PIO/SM.
- `src/main.rs`: binds PIO0/PIO1/PIO2 IRQs, creates **X/Y** axes, queues demo segments per axis.
- `src/motion/planner_stub.rs`: tiny helper to enqueue demo segments per axis.

## Enable more axes
Uncomment the **Z/A/B/C** sections in `main.rs`, supply pins, and create `Output` for DIR/EN.

## Queue depth
Set `AXIS_QUEUE_DEPTH` (256 or 512). Memory per axis ≈ `depth × 12B` (e.g., 256 → ~3KB; 512 → ~6KB).
